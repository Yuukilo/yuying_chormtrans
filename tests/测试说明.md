# 语影翻译扩展测试说明

## 问题背景

之前遇到的 `ReferenceError: document is not defined` 错误已经通过修改 webpack 配置得到解决。该错误是由于在 Service Worker 环境中尝试访问 DOM API 导致的。

## 修复内容

1. **修改 webpack 配置**：将 `background.js` 的 `target` 从 `webworker` 改为 `['web', 'es2020']`
2. **ES6 模块支持**：在 `manifest.json` 中设置 `type: "module"`
3. **避免 DOM 引用**：确保 Service Worker 中不包含 `document` 等 DOM API 调用

## 测试方法

### 方法一：使用测试页面

1. **打开测试页面**：
   ```
   在浏览器中打开：file:///d:/test/test-extension-simple.html
   ```

2. **加载扩展**：
   - 打开 Chrome 浏览器
   - 进入 `chrome://extensions/`
   - 开启"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择 `d:\test\dist` 文件夹

3. **查看测试结果**：
   - 测试页面会自动运行完整的扩展测试
   - 查看页面底部的状态区域，观察测试结果
   - 正常情况下应该看到：
     - ✅ Chrome扩展API可用
     - ✅ 扩展已加载
     - ✅ 扩展通信成功
     - ✅ 设置获取成功

### 方法二：手动验证

1. **检查扩展加载**：
   - 在 `chrome://extensions/` 页面确认扩展已启用
   - 检查是否有错误信息

2. **检查 Service Worker**：
   - 在扩展详情页面点击"Service Worker"链接
   - 查看控制台是否有 `document is not defined` 错误
   - 正常情况下应该看到翻译服务初始化成功的消息

3. **测试翻译功能**：
   - 在任意网页上选择文本
   - 查看是否出现翻译按钮
   - 点击翻译按钮测试功能

## 预期结果

### 成功指标

- ✅ 扩展能正常加载，无错误信息
- ✅ Service Worker 控制台无 `document is not defined` 错误
- ✅ 翻译服务能正常初始化
- ✅ 扩展与页面能正常通信
- ✅ 设置能正常读取和保存

### 可能的警告（正常）

- ⚠️ 翻译功能测试失败（需要配置 API 密钥）
- ⚠️ 某些高级功能未启用（需要用户配置）

## 故障排除

### 如果仍然出现 `document is not defined` 错误

1. **清除扩展缓存**：
   - 在 `chrome://extensions/` 中移除扩展
   - 重新加载扩展

2. **检查编译结果**：
   ```bash
   cd d:\test
   npm run build
   ```
   确保编译无错误

3. **检查 webpack 配置**：
   确认 `webpack.config.js` 中 background 的配置为：
   ```javascript
   target: ['web', 'es2020']
   ```

### 如果扩展无法加载

1. **检查 manifest.json**：
   确认 `type: "module"` 配置正确

2. **检查文件路径**：
   确认所有引用的文件都存在于 `dist` 目录中

3. **查看详细错误**：
   在扩展详情页面查看具体的错误信息

## 测试文件说明

- `test-extension-simple.html`：主要测试页面，包含多语言文本和完整的测试流程
- `test-extension-loading.js`：独立的测试脚本，可以在任何页面中使用
- `测试说明.md`：本说明文档

## 联系支持

如果测试过程中遇到问题，请提供：
1. 浏览器控制台的完整错误信息
2. 扩展 Service Worker 控制台的日志
3. 测试页面显示的具体错误信息
4. Chrome 版本和操作系统信息

---

**注意**：此测试主要验证扩展的基础加载和通信功能，完整的翻译功能需要配置相应的 API 密钥。